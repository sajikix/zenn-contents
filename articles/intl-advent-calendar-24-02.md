---
title: "ロケール識別子(BCP47)とUnicode拡張について(#2)"
emoji: ""
type: "tech"
topics: ["Intl", "i18n", "frontend"]
published: false
publication_name: "cybozu_frontend"
---

この記事は「[1 人 Intl Advent Calendar 2024](https://adventar.org/calendars/10555)」の 2 日目の記事です。

今回はロケール識別子(言語タグ)とその仕様 BCP47 について解説します。

## ロケール識別子について

[1 日目の記事]()で解説した通り、Intl のコンストラクタプロパティは必ず第１引数にロケール識別子か Intl.Locale オブジェクト(またはそれらの配列)を受け取ります。この記事ではその中でも一般的に使われる「ロケール識別子」についてその仕様を確認しておきます。(Intl.Locale オブジェクトについては続く 3 日目と 4 日目の記事で詳しく解説します。)

### ロケール識別子の仕様 : BCP47

ロケール識別子は「言語タグ」などとも呼ばれるロケールを識別するための文字列のことです。具体的には `"ja-JP"` や `"en-US"` といったよく目にする文字列がこれにあたります。

このロケール識別子は IETF という標準化団体が策定する２つの仕様、[RFC 5646]() と [RFC 4647]() でその仕様が定義されています。またこの２つの仕様を合わせて **BCP47(Best Current Practice)**[^1]と呼びます。このことからロケール識別子は IETF 言語タグなどとも呼ばれます。

### BCP47 の基本 : サブタグ

ロケール識別子は「サブタグ」と呼ばれる要素を `-` でつないだ文字列で構成されます。サブタグには次の 6 種類が存在し、上から順にサブタグをつなげていくことで 1 つの言語タグが構成されます。

- 言語サブタグ
  - 言語を表す文字列
  - 例: `ja` や `en` など
- 文字体系サブタグ
  - 文字体系を表す文字列
  - 例: `Hant`(繁体字) / `Hans`(簡体字) など
- 地域 (または国) サブタグ
  - 国や地域を表す文字列
  - 例: `CN` , `US` など
- 変化形サブタグ
  - 言語の方言や変化系などを表す文字列
  - `emodeng`("Early modern English" 方言) など
  - 複数指定できるがすべて固有でなければならない
- BCP 47 拡張シーケンス
  - 単一の数字または文字 ("x" 以外) と、ハイフンで区切られた 1 つ以上の 2 から 8 文字の文字または数字によるサブタグ
  - 例: `u-ca-japanese`
  - 複数指定できる
- 私的に使用する拡張シーケンス
  - 私的利用部分

実際にこれらを `"-"` つなぐと以下のような形になります。

```
[言語]-[文字体系]-[地域]-[変化形]-[BCP 47 拡張]-[私的に使用する拡張]
```

たとえば、1~3 つ目のサブタグを使って「台湾で利用される繁体字の中国語」を表したい場合 `zh-Hant-TW` のようになるわけです。

ちなみに言語、文字体系、地域、変化形サブタグで使える値に関しては IANA[^2] の[language Subtag Registry](https://www.iana.org/assignments/language-subtag-registry/language-subtag-registry)で管理されています。これらの値は定期的に更新されていますが、ブラウザに反映されるには時間差があったりするので注意しましょう。

### BCP 47 拡張シーケンスと u 拡張

この中でもあまり見慣れないであろう 5 番目のサブタグ、「BCP 47 拡張シーケンス」についてもう少し掘り下げましょう。

BCP 47 拡張シーケンスは　`[1文字(x以外)]-[2~8文字]-[2~8文字(任意)]` という形で構成されるサブタグで、ロケール識別子に情報を追加し拡張することを目的に作られたサブタグです。ただしユーザーが好きに設定できるわけではなく、許可[^3]された形のものしか指定できません。現在登録されているものは以下の３種類です。

- "u" (Unicode) 拡張
  - ロケールを識別するために必要な追加情報を含めることができる
  - `u-[key]-[value]` の形式
  - 例: `u-ca-japanese` → 日時書式で和暦を使用
- "t" (transformed) 拡張
  - 他のロケールから翻訳されたテキストなど、変換されたコンテンツを示す
  - `t-[value]`
  - 例: `t-it` → イタリア語からの翻訳
- "x"拡張
  - ユーザーで好きに使えるの拡張シーケンス
  - `ja-JP-x-saji` みたいなことができる

このうち Unicode 拡張部分の細かい仕様(実際にどのような key と value を持つのか)は Unicode 側に任されています。実際にどのような key と value が入るかは以下のドキュメントを参考にしてください。

https://www.unicode.org/reports/tr35/#Locale_Extension_Key_and_Type_Data

またこの中で、"t" (transformed) 拡張と"x"拡張は Intl ですべて無視されますが、 Unicode 拡張は `Intl` の各所で解釈され挙動のカスタマイズに使用されます。たとえば `Intl.DateTimeFormat()` を利用する際に `ja-JP-u-ca-japanese` というロケール識別子でロケールを指定すると「日時書式に和暦を使用する」という意味になります。

```ts
const formatter = new Intl.DateTimeFormat("ja-JP-u-ca-japanese"); // u-ca-japanese がUnicode拡張
formatter.format(new Date(Date.UTC(2023, 7, 7)));
// → 'R5/8/7'（和暦）
```

今度の記事の説明で `u-[key]-[value]` のようなサブタグが出てきた時はこの記事の説明を思い出して読み進めてください。

## まとめ

今回はケール識別子(言語タグ)とその仕様 BCP47 について解説しました。次回 3 日目では Intl.Locale のプロパティと Intl Locale Info proposal について解説します。

## 参考文献

- https://www.unicode.org/reports/tr35/#Locale_Extension_Key_and_Type_Data

[^1]: BCP は IETF の策定する仕様形態のひとつ
[^2]: インターネットに関するリソースを管理する団体。言語タグ以外にもなども管理している。
[^3]: IETF によって許可された拡張のみが構文として許されています。
