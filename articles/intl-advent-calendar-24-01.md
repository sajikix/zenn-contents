---
title: "Intlの全体像と基本となるIF(#1)"
emoji: ""
type: "tech"
topics: ["Intl", "i18n", "frontend"]
published: false
publication_name: "cybozu_frontend"
---

この記事は「[1 人 Intl Advent Calendar 2024](https://adventar.org/calendars/10555)」の 1 日目の記事です。

アドベントカレンダーの初回である今回はアドベントカレンダー自体の説明、 JS の国際化 API「Intl」の概要・仕様的な位置付け、基本となる構成要素・IF などを紹介します。

## このアドベントカレンダーについてと構成

このアドベントカレンダーは JavaScript(ECMAScript)の国際化 API、「Intl」について紹介するものです。2024 末時点での Intl 仕様と提案されている Proposal を広く紹介することをゴールとしています。合わせて Intl に関連する仕様についても端端で紹介するつもりです。

機能・ドメイン的に関連する話題をまとめて紹介していくので、「既存仕様 → 関連する Proposal」の順で繰り返す流れになる予定です。基本的な機能だけ知りたいよと言う方は適宜読み飛ばしてください。

### 前提となる知識・ワード

このアドベントカレンダーではその題材の性質上、頻繁に JavaScript の仕様並びに仕様策定に関わる用語が出てきます。ある程度 JavaScript の仕様に興味がある人は知っている知識かもしれませんが、触れたことがない方は以下の記事などを読んで前提知識を持っておくと読みやすいです。

https://jsprimer.net/basic/ecmascript/

以降の文書・記事では「ECMAScript」、「Proposal」、「Stage」といったワードを使いますが、「それなんだっけ？」となった場合はこちらの記事などで振り返ると良いでしょう。

## Intl とは

Intl は ECMAScript(JavaScript[^1]) にある名前空間です。 `Intl.〇〇`　のように　`Intl` 配下にある各 API はみな「国際化」に関連する機能を提供しています。

### 国際化 API のやること

単に「国際化機能」と言われてもピンと来ないかもしれません。Intl の仕様書の序文ではその適用範囲について以下のように述べています。

> This Standard defines the application programming interface for ECMAScript objects that support programs that need to adapt to the linguistic and cultural conventions used by different human languages and countries.(from ECMA-402, 10th edition)

ざっくり訳すと「さまざまな国や言語・文化によって変わってしまう部分・処理」をサポートする機能をまとめた API と言うところでしょうか。

具体的には以下のような国際化機能を `Intl` は提供しています。

- 日時のフォーマット
- 数値のフォーマット
- 複数形や序数など各言語の数に対する文法上の分類判別
- 見た目上の一文字(書記素)や単語、文レベルの分割
- ロケールの解決
- 言語に依存した文字列の比較

### Intl の利点

`Intl` 最大の利点は、主要ブラウザや Node.js などのランタイムで言語機能としてサポートされていることです。具体的には次のようなメリットがあります。

- 実装にサードパーティのライブラリを必要としない
  - JavaScript の組み込みオブジェクトとして利用できるので専用のライブラリなどを追加する必要がありません。これにより専用のライブラリを使っている場合はバンドルサイズの減少が見込めます。またライブラリ独自の記法に依存しないことでコードの再利用性も高くなります。
- 後方互換性がある程度保証される
  - JavaScript の補完という形で常に後方互換性を考えながらアップデートされていくため安心して実装できます。これは破壊的な API 変更などの可能性があるライブラリなどとは異なるメリットです。

### 仕様の位置付けと策定

`Intl` は JavaScript の API として利用できますが、仕様の位置付けは他の JavaScript 標準仕様(= ECMAScript)と少し異なっています。

より厳密に Intl の位置付けを説明すると「ECMAScript を拡張する形で標準化している ECMAScript の国際化 API の総称」と言うことになります。

このように Intl は ECMAScript の**拡張仕様**なので一般的な ECMAScript の仕様と別れた仕様番号[^2]で管理されています。一般的な ECMAScript の仕様が ECMA262 と言う仕様番号がついているのに対し、Intl は ECMA402 という仕様番号で管理されています。この ECMA262 と ECMA402 を合わせた集合がいわゆる「JavaScript の仕様」として一般的に捉えられていると理解して良いでしょう。

#### Intl の仕様について調べるときの注意点

単に「仕様番号が分かれているだけ」であれば特段困ることもないのですが、ECMA262 の拡張仕様と言う位置付け上、仕様書自体や議事録などのリソースが一般的な ECMAScript の仕様(ECMA262)と分かれている場合があります。そのため Intl の仕様について細かく調べたり、策定中の Proposal について追いたい場合はこのことを理解しておく必要があります。それぞれ具体的に見ていきましょう。

まず仕様番号が違うので仕様書も ECMA262 とは別に記述されており、異なる URL で公開されています。

https://tc39.es/ecma402/

また Intl(ECMA402) の仕様は TC39 の中でも専門の TaskGroup(TC39 の中の５つある分科会)[^3] で議論されていることが多く、 ECMAScript 全体の meeting とは別に ECMA402 の(ほぼ)月次ミーティング議事録が残されています。

https://github.com/tc39/ecma402/tree/main/meetings

もちろん ECMAScript 全体の meeting でも ECMA402 の Proposal について話されることはありますが、Proposal の詳細や近況を調べたい場合はこちらも参照すると良いでしょう。

さらに細かい違いですが、提案されている Proposal の一覧も ECMA262 に対するものとは別のパスで管理されているので探す時には注意が必要です。

https://github.com/tc39/proposals/blob/HEAD/ecma402/README.md

このように Intl について調べていると他の ECMAScript と微妙にリソースが分かれていることがあるので注意しながら調べるようにしましょう。

#### 豆知識 : Intl の歴史

<!-- TODO -->

## Intl API の全体像と基本となる IF

次に Intl API の全体像と基本となる IF について見ていきます。

### コンストラクタプロパティとメソッド

Intl は多くの機能をコンストラクタプロパティとして保持しており、2024 年 12 月現在 9 つのコンストラクタプロパティを持っています。

- `Intl.Collator()`
- `Intl.DateTimeFormat`
- `Intl.DisplayNames()`
- `Intl.ListFormat()`
- `Intl.Locale()`
- `Intl.NumberFormat()`
- `Intl.PluralRules`
- `Intl.RelativeTimeFormat()`
- `Intl.Segmenter()`

またそれ以外にロケールや Intl 自体の機能に関するメタ的な情報を返すメソッドが 2 つ存在しています。

- `Intl.getCanonicalLocales()`
- `Intl.supportedValuesOf()`

これらのメソッドに関しては 5 日目に詳しく解説します。

### コンストラクタの基本となる IF

Intl の主要な機能はコンストラクタプロパティとして提供されるので、使う際はそれぞれのコンストラクタプロパティを初期化 (`new`)　して使うことになります。初期化する際の引数はオプションの違いこそありますが、どのコンストラクタプロパティの引数も比較的共通した形を持っています。

具体的に各コンストラクタプロパティは皆以下の２つの引数を受け取ります。

1. ロケール識別子 or Intl.Locale オブジェクト
2. 初期化する際のオプション

```ts
// Intl.DateTimeFormat での例
const formatter = new Intl.DateTimeFormat("ja-JP", { calendar: "japanese" });
```

#### 1. ロケール識別子 or Intl.Locale オブジェクト

１つ目の引数はロケール識別子か Intl.Locale オブジェクトを受け取ります。

ロケール識別子とは以下のようなロケールを表す文字列のことで言語タグと呼ばれたりもします。

- `ja-JP`
- `en-US`

ロケール識別子自体は ECMAScript とは別に IETF の BCP47 という仕様群によって定義されています。BCP47 について 4 日目の記事に詳しく解説しますが、一旦は言語や地域などを表す決まった文字列のことだと思ってください。

もう 1 つの Intl.Locale オブジェクトは Intl が用意している、「ロケール情報をより簡単に操作するため」のオブジェクトです。表せる情報の範囲で言えばロケール識別子で問題ないのですが、ロケール識別子が持つようなロケールについての情報を解析・操作しやすいインターフェースを提供しています。この Intl.Locale オブジェクトについては続く 2 日目と 3 日目で解説します。

#### 2. 初期化する際のオプション

２つ目の引数では各機能の挙動を制御するためのオプションを受け取ります。具体的に機能ごとの例を挙げると以下の通りです。

- 日時のフォーマット → 年月日の細かい表記法、24 時間表記か...など
- 数値のフォーマット → 桁数、単位、区切り文字を使うか.... など
- 分ち書き → 単位は「文字」か「単語」か「文」...など

### コンストラクタプロパティを `new` して使う

このように Int の機能はコンストラクタプロパティで提供されており、それらのコンストラクタを `new` して得られたインスタンスで書式化や判別などを行います。

例えば　`Intl.DateTimeFormat` や `Intl.NumberFormat()` だったら `format()` メソッドが、 `Intl.Segmenter()` だったら `segment()` メソッドがといった形で、各インスタンスに実際にその国際化機能を使うためのメソッドが生えています。

```ts
// Intl.DateTimeFormat での例
const formatter = new Intl.DateTimeFormat("ja-JP", { calendar: "japanese" });
// 実際にフォーマットする
formatter.format(new Date("2024-12-01")); // R6/12/1
```

このように Intl の使い方は「まずロケールと挙動のオプションを指定してインスタンス作ってからそのインスタンスを利用する」という点がポイントになります。

### なぜ一度インスタンスを作るのか(想像)

ここからは仕様策定の議論をしっかり追ったわけではないので多分に筆者の想像を含みますが、Intl は「作成したインスタンスをアプリケーション全体で共有する前提のもと設計されている」のではないかと考えます。

そもそも、任意のロケールにおいてアプリケーション内での書式・挙動は統一されていることが望ましいです。実際表示される場所によって数値や日時の表記が異なっていたりしたら違和感があると思います。一方でもし毎回フォーマットや判別のたびにロケールやオプションを渡す IF だと純粋に同じ値を指定するのが面倒ですし、指定をミスしただけで表記ゆれが発生してしまいます。

このようなミスや表記揺れ・挙動差を防ぎ、アプリケーション内で統一するためにも、「ロケールやオプションを指定するのは初期化時だけ」「あとは初期化したインスタンスを使い回す(限り挙動は統一される)」といった設計になっているのではないでしょうか。

この点を踏まえて Intl の機能を使う際はなるべく初期化したインスタンス(or それらをラップしたもの)をアプリケーション全体で共有することを意識できると良さそうです。

## まとめと次回予告

今回は Intl についての概要と、仕様の位置付け、基本となる IF などについて解説しました。次回 2 日目は `Intl.Locale` オブジェクトとそのオプションについて解説していきます。

[^1]: JavaScript の仕様に言及する場合は原則 ECMAScript の名称を使用します。
[^2]: ECMA International では策定している仕様ごとに番号がついています。
[^3]: Intl などの国際化 API について話し合うのは TG2 です。
