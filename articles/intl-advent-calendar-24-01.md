---
title: "Intlの全体像と基本となるIF(#1)"
emoji: ""
type: "tech"
topics: ["Intl", "i18n", "frontend"]
published: false
publication_name: "cybozu_frontend"
---

この記事は「[1 人 Intl Advent Calendar 2024](https://adventar.org/calendars/10555)」の 1 日目の記事です。

アドベントカレンダーの初回である今回はアドベントカレンダー自体の説明、 JS の国際化 API「Intl」の概要・仕様的な位置付け、基本となる構成要素・IF などを紹介します。

## このアドベントカレンダーについてと構成

このアドベントカレンダーは JavaScript(ECMAScript)の国際化 API、「Intl」について紹介するものです。2024 末時点での Intl 仕様と提案されている Proposal を広く紹介することをゴールとしています。合わせて Intl に関連する仕様についても端端で紹介するつもりです。

機能・ドメイン的に関連する話題をまとめて紹介していくので、「既存仕様 → 関連する Proposal」の順で繰り返す流れになる予定です。基本的な機能だけ知りたいよと言う方は適宜読み飛ばしてください。

### 前提となる知識・ワード

このアドベントカレンダーではその題材の性質上、頻繁に JavaScript の仕様並びに仕様策定に関わる用語が出てきます。ある程度 JavaScript の仕様に興味がある人は知っている知識かもしれませんが、触れたことがない方は以下の記事などを読んで前提知識を持っておくと読みやすいです。

https://jsprimer.net/basic/ecmascript/

以降の文書・記事では「ECMAScript」、「Proposal」、「Stage」といったワードを使いますが、「それなんだっけ？」となった場合はこちらの記事などで振り返ると良いでしょう。

## Intl とは

Intl は ECMAScript(JavaScript[^1]) にある名前空間です。 `Intl.〇〇`　のように　`Intl` 配下にある各 API はみな「国際化」に関連する機能を提供しています。

### 国際化 API のやること

単に「国際化機能」と言われてもピンと来ないかもしれません。Intl の仕様書の序文ではその適用範囲について以下のように述べています。

> This Standard defines the application programming interface for ECMAScript objects that support programs that need to adapt to the linguistic and cultural conventions used by different human languages and countries.(from ECMA-402, 10th edition)

ざっくり訳すと「さまざまな国や言語・文化によって変わってしまう部分・処理」をサポートする機能をまとめた API と言うところでしょうか。

具体的には以下のような国際化機能を `Intl` は提供しています。

- 日時のフォーマット
- 数値のフォーマット
- 複数形や序数など各言語の数に対する文法上の分類判別
- 見た目上の一文字(書記素)や単語、文レベルの分割
- ロケールの解決
- 言語に依存した文字列の比較

### Intl の利点

`Intl` 最大の利点は、主要ブラウザや Node.js などのランタイムで言語機能としてサポートされていることです。具体的には次のようなメリットがあります。

- 実装にサードパーティのライブラリを必要としない
  - JavaScript の組み込みオブジェクトとして利用できるので専用のライブラリなどを追加する必要がありません。これにより専用のライブラリを使っている場合はバンドルサイズの減少が見込めます。またライブラリ独自の記法に依存しないことでコードの再利用性も高くなります。
- 後方互換性がある程度保証される
  - JavaScript の補完という形で常に後方互換性を考えながらアップデートされていくため安心して実装できます。これは破壊的な API 変更などの可能性があるライブラリなどとは異なるメリットです。

### 仕様の位置付けと策定

`Intl` は JavaScript の API として利用できますが、仕様の位置付けは他の JavaScript 標準仕様(= ECMAScript)と少し異なっています。

より厳密に Intl の位置付けを説明すると「ECMAScript を拡張する形で標準化している ECMAScript の国際化 API の総称」と言うことになります。

このように Intl は ECMAScript の**拡張仕様**なので一般的な ECMAScript の仕様と別れた仕様番号[^2]で管理されています。一般的な ECMAScript の仕様が ECMA262 と言う仕様番号がついているのに対し、Intl は ECMA402 という仕様番号で管理されています。この ECMA262 と ECMA402 を合わせた集合がいわゆる「JavaScript の仕様」として一般的に捉えられていると理解して良いでしょう。

#### Intl の仕様について調べるときの注意点

単に「仕様番号が分かれているだけ」であれば特段困ることもないのですが、ECMA262 の拡張仕様と言う位置付け上、仕様書自体や議事録などのリソースが一般的な ECMAScript の仕様(ECMA262)と分かれている場合があります。そのため Intl の仕様について細かく調べたり、策定中の Proposal について追いたい場合はこのことを理解しておく必要があります。それぞれ具体的に見ていきましょう。

まず仕様番号が違うので仕様書も ECMA262 とは別に記述されており、異なる URL で公開されています。

https://tc39.es/ecma402/

また Intl(ECMA402) の仕様は TC39 の中でも専門の TaskGroup(TC39 の中の５つある分科会)[^3] で議論されていることが多く、 ECMAScript 全体の meeting とは別に ECMA402 の(ほぼ)月次ミーティング議事録が残されています。

https://github.com/tc39/ecma402/tree/main/meetings

もちろん ECMAScript 全体の meeting でも ECMA402 の Proposal について話されることはありますが、Proposal の詳細や近況を調べたい場合はこちらも参照すると良いでしょう。

さらに細かい違いですが、提案されている Proposal の一覧も ECMA262 に対するものとは別のパスで管理されているので探す時には注意が必要です。

https://github.com/tc39/proposals/blob/HEAD/ecma402/README.md

このように Intl について調べていると他の ECMAScript と微妙にリソースが分かれていることがあるので注意しながら調べるようにしましょう。

## Intl API の全体像と基本となる IF

次に Intl API の全体像と基本となる IF について見ていきます。

### コンストラクタプロパティとメソッド

Intl は多くの機能をコンストラクタプロパティとして保持しており、2024 年 12 月現在 9 つのコンストラクタプロパティを持っています。

- `Intl.Collator()`
- `Intl.DateTimeFormat`
- `Intl.DisplayNames()`
- `Intl.ListFormat()`
- `Intl.Locale()`
- `Intl.NumberFormat()`
- `Intl.PluralRules`
- `Intl.RelativeTimeFormat()`
- `Intl.Segmenter()`

またそれ以外にロケールや Intl 自体の機能に関するメタ的な情報を返すメソッドが 2 つ存在しています。

- List
<!-- todo list -->

### コンストラクタの基本となる IF

Intl の主要な機能はコンストラクタプロパティとして提供されるので使う際はそれぞれのコンストラクタプロパティを初期化 (`new`)　して使うことになります。初期化する際の引数はオプションの違いこそありますが、どのコンストラクタプロパティも比較的共通した形を持っています。

具体的に、各コンストラクタプロパティは皆以下の２つの引数を受け取ります。

1. ロケール文字列 or Intl.Locale オブジェクト
2. 初期化する際のオプション

<!-- ロケール文字列 -->

<!-- くわしくは3日目と5日目 -->

<!-- オプションはそれぞれの機能を制御する -->

<!-- コンストラクタをnewして得られたインスタンスで書式化や判別などを行う -->

<!-- 一旦ロケールと挙動のオプションを指定してインスタンス作るのがみそ -->

<!-- Intl側も作ったインスタンスを共有する前提で設計してそう -->
<!-- そもそもアプリケーション内で国際化による挙動や書式は統一すべき -->
<!-- いちいちロケールを指定するのは大変だしオプションの指定ミスだってある -->
<!-- そういったことを防ぐ目的もあるのではないか -->
<!-- これを意識できると良さそう -->

## まとめと次回予告

<!-- 今回はIntlについての概要と基本となるIFの説明をした -->
<!-- 明日は Intl.Localeオブジェクトとそのオプションについて書きます -->

[^1]: JavaScript の仕様に言及する場合は原則 ECMAScript の名称を使用します。
[^2]: ECMA International では策定している仕様ごとに番号がついています。
[^3]: Intl などの国際化 API について話し合うのは TG2 です。
