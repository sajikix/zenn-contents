---
title: "Intl.Segmenter v2 Proposal(#21)"
emoji: "â†©ï¸"
type: "tech"
topics: ["Intl", "i18n", "frontend"]
published: true
---

ã“ã®è¨˜äº‹ã¯ã€Œ[1 äºº Intl Advent Calendar 2024](https://adventar.org/calendars/10555)ã€ã® 21 æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚

ä»Šå›ã¯ Intl.Segmenter ã«æ–°ã—ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ Intl.Segmenter v2 proposal ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

## Intl.Segmenter v2 Proposal

Intl.Segmenter ã¯å‰å›[20 æ—¥ç›®ã®è¨˜äº‹](https://zenn.dev/sajikix/articles/intl-advent-calendar-24-20)ã§è§£èª¬ã—ãŸé€šã‚Šã€ãƒ­ã‚±ãƒ¼ãƒ«ã‚’è€ƒæ…®ã—ã¤ã¤ã€æŒ‡å®šã•ã‚ŒãŸç²’åº¦ã§æ–‡å­—åˆ—ã‚’åˆ†å‰²ã™ã‚‹ãŸã‚ã® API ã§ã™ã€‚Intl.Segmenter v2 proposal ã¯ã“ã® Intl.Segmenter ã«æ–°ã—ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ Stage1 ã®ææ¡ˆã§ã™ã€‚

https://github.com/tc39/proposal-intl-segmenter-v2

### ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

Intl.Segmenter v2 proposal ã§ã¯æ–°ã—ãæ–‡å­—åˆ—ã‚’åˆ†å‰²ã™ã‚‹ç²’åº¦ã¨ã—ã¦ã€Œè¡Œã€ã‚’ã‚µãƒãƒ¼ãƒˆã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚

é©åˆ‡ãªè¡Œã§ã®åˆ†å‰²ã¯ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ãŠã„ã¦é‡è¦ãªè¦ç´ ã§ã‚ã‚Šã€ç‰¹ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå ´æ‰€ã§ãƒ‹ãƒ¼ã‚ºãŒã‚ã‚Šã¾ã™ã€‚

- Canvas ã‚„ SVG ãªã©ã®å†…éƒ¨ã§ Text ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å ´åˆ
- CLI ã‚„ã‚³ãƒ¼ãƒ‰åŸ‹ã‚è¾¼ã¿ãªã©ã«ãŠã‘ã‚‹é©åˆ‡ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° : ä¾‹) github ã®ã‚½ãƒ¼ã‚¹ diff è¡¨ç¤º
- HTML ã®æ–‡è„ˆå¤–ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å ´åˆ : ä¾‹) PDF ã®ç”Ÿæˆ
- WebGL ã‚„ WebXR ã§ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°

ã“ã®ã‚ˆã†ãªå‡¦ç†ã«å¯¾ã—ã¦éƒ½åº¦ã€è¡Œåˆ†å‰²ã®ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã“ã¨ã¯å®¹é‡ã®è¦³ç‚¹ã‹ã‚‰ã—ã¦ã‚‚ç¾å®Ÿçš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚(å®Ÿéš›å¤šãã®ãƒ­ã‚±ãƒ¼ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‹ãªã‚Šã®å®¹é‡ã«ãªã‚‹ã‚ˆã†ã§ã™ã€‚)

ãã®ãŸã‚ Intl.Segmenter ã® 1 æ©Ÿèƒ½(=JS ã®æ¨™æº–æ©Ÿèƒ½)ã¨ã—ã¦è¡Œåˆ†å‰²ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

::: message

å®Ÿã¯ Chromium ã«ã¯ã™ã§ã«ã“ã‚Œã«è¿‘ã„æ©Ÿèƒ½(ã‚ªãƒ—ã‚·ãƒ§ãƒ³)ã‚’æœ‰ã™ã‚‹ `Intl.v8BreakIterator` ã¨ã„ã† API ãŒå­˜åœ¨ã—ã¦ã¾ã™ã€‚ãŸã ã—ã“ã® API ã¯ V8 ãŒå®Ÿè£…ã™ã‚‹ Chromium ç‹¬è‡ªã® API ã§éæ¨™æº–ãªã‚‚ã®ã§ã™ã€‚

```ts
const itr = new Intl.v8BreakIterator(["ja-jp"], { type: "line" });
```

ã•ã‚‰ã«ã€ã“ã®æ©Ÿèƒ½ã¯ 2024 å¹´ 11 æœˆã«éæ¨å¥¨ã¨ã™ã‚‹ã“ã¨ãŒææ¡ˆã•ã‚Œã€ã‚†ãã‚†ãã¯ Chromium ä¸¦ã³ã« v8 ã‹ã‚‰ã‚‚å‰Šé™¤ã•ã‚Œã‚‹ã“ã¨ãŒäºˆå®šã•ã‚Œã¦ã„ã¾ã™ã€‚

https://chromestatus.com/feature/4973414383878144

:::

### ææ¡ˆã•ã‚Œã¦ã„ã‚‹å®Ÿéš›ã® API

Intl.Segmenter v2 proposal ã§ã¯ API ã®å¤‰æ›´ã¨ã—ã¦ä»¥ä¸‹ã®ï¼’ç‚¹ãŒææ¡ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

- `granularity` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã« `"line"` ã‚’è¿½åŠ 
- `lineBreakStyle` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ–°ãŸã«è¿½åŠ 

`granularity` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã« `"line"` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§åˆ†å‰²å˜ä½ã‚’ã€Œè¡Œã€ã«æŒ‡å®šã§ãã¾ã™ã€‚

```ts
const segmenter = new Intl.Segmenter("ja-JP", {
  granularity: "line",
});
```

ã¾ãŸã“ã®æ™‚ Intl.Segmenter ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã® `segment()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¿”ã™ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã«ã¯ `isHardBreak` ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒè¿½åŠ ã•ã‚Œã€ãã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒãƒãƒ¼ãƒ‰ãƒ–ãƒ¬ãƒ¼ã‚¯(å¼·åˆ¶æ”¹è¡Œ)ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã™ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts
{
  "segment": "ã“ã‚“ã«ã¡ã¯",
  "index": 0,
  "input": "ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œã€‚",
  "isHardBreak": false // ğŸ†•
}
```

ã“ã‚Œã¯ `granularity` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã« `"word"` ã‚’æŒ‡å®šã—ãŸå ´åˆã® `isWordLike` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨åŒæ§˜ã®æ©Ÿèƒ½ã§ã™ã€‚

ã¾ãŸ `lineBreakStyle` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ `"strict"`, `"normal"`, `"loose"` ã® 3 ã¤ã®å€¤ã‚’å–ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ CSS Text Level 3 ã§ä¸­å›½èªãƒ»æ—¥æœ¬èªãƒ»éŸ“å›½èªï¼ˆCJKï¼‰ãƒ†ã‚­ã‚¹ãƒˆã®æ”¹è¡Œæ–¹æ³•ã‚’æŒ‡å®šã™ã‚‹ `line-break` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«æŒ‡å®šã§ãã‚‹å€¤ã¨åŒæ§˜ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæŒ™å‹•ã‚’ã™ã‚‹ã“ã¨ãŒææ¡ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

- `"strict"`ï¼šæœ€ã‚‚å³æ ¼ãªæ”¹è¡Œè¦å‰‡ã‚’ç”¨ã„ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’æ”¹è¡Œã™ã‚‹ã€‚
  - é•·ã„è¡Œã«ã‚ˆãä½¿ã‚ã‚Œã‚‹ã€‚
- `"normal"`ï¼šæœ€ã‚‚ä¸€èˆ¬çš„ãªæ”¹è¡Œè¦å‰‡ã‚’ç”¨ã„ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’æ”¹è¡Œã™ã‚‹ã€‚
  - æ›¸ç±ã‚„æ–‡æ›¸ã«ã‚ˆãä½¿ã‚ã‚Œã‚‹ã€‚
- `"loose"`ï¼šæœ€ã‚‚åˆ¶ç´„ã®å°‘ãªã„æ”¹è¡Œè¦å‰‡
  - æ–°èãªã©ã®çŸ­ã„è¡Œã§ä½¿ã‚ã‚Œã‚‹

å¾“ã£ã¦ `"strict"` > `"normal"` > `"loose"` ã®é †ã§æœ¬å½“ã«æ”¹è¡Œã—ã¦è‰¯ã•ãã†ãªã¨ã“ã‚ã§ã—ã‹ã€Œæ”¹è¡Œã§ãã‚‹ã€ã¨ãƒãƒ¼ã‚¯ã—ãªããªã‚Šã¾ã™ã€‚

è©³ã—ã„æ”¹è¡Œã®ãƒ«ãƒ¼ãƒ«ã¯ Unicode Standard Annex #14 Unicode Line Breaking Algorithm ã«å¾“ã†ã‚ˆã†ãªã®ã§ãã¡ã‚‰ã‚‚å‚ç…§ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

https://unicode.org/reports/tr14/

## ã¾ã¨ã‚ã¨æ¬¡å›äºˆå‘Š

ã“ã®è¨˜äº‹ã§ã¯è¡Œå˜ä½ã§ã®æ–‡å­—åˆ—åˆ†å‰²ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ Intl.Segmenter v2 proposal ã«ã¤ã„ã¦ãã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ææ¡ˆã•ã‚Œã¦ã„ã‚‹ API ãªã©ã‚’è§£èª¬ã—ã¾ã—ãŸã€‚

æ¬¡å›[22 æ—¥ç›®](https://zenn.dev/sajikix/articles/intl-advent-calendar-24-22)ã§ã¯è¨€èªã€åœ°åŸŸã€æ–‡å­—ä½“ç³»ã®è¡¨ç¤ºåã®ä¸€è²«ã—ãŸç¿»è¨³ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ Intl.DisplayNames ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

- Intl Segmenter v2 Proposal
  - https://github.com/tc39/proposal-intl-segmenter-v2
- Unicode Standard Annex #14 Unicode Line Breaking Algorithm
  - https://unicode.org/reports/tr14/
